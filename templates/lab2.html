<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Lab 2 | Terraform Modules</title>
    <link rel="stylesheet" href="/static/style.css" />
  </head>
  <body>
    <div class="noise"></div>
    <main class="page">
      <section class="hero">
        <div class="badge">Lab 2</div>
        <h1>Terraform Modules: Files Service + S3</h1>
        <p>
          Extend the platform with a new microservice that uploads, lists, and downloads
          files from S3. You will implement Terraform modules to provision the AWS + Kubernetes
          resources and wire IRSA for secure access.
        </p>
        <div class="nav-links">
          <a class="ghost-link" href="/">Submission</a>
          <a class="ghost-link" href="/lab1">Lab 1</a>
          <a class="ghost-link" href="/leaderboard">Leaderboard</a>
          <a class="ghost-link" href="/admin">Admin</a>
        </div>
      </section>

      <section class="panel">
        <div class="results-header">
          <h2>What you need to build</h2>
        </div>
        <div class="notes">
          <div>
            <h3>Terraform modules</h3>
            <p>Create a reusable module for the files-service and its AWS dependencies.</p>
          </div>
          <div>
            <h3>S3 + IAM</h3>
            <p>Provision an S3 bucket and an IAM policy/role with IRSA for the pod.</p>
          </div>
          <div>
            <h3>Kubernetes</h3>
            <p>Deploy the new service, service account, ClusterIP service, and ingress route.</p>
          </div>
          <div>
            <h3>Validation</h3>
            <p>Verify upload, list, and download flows from the UI.</p>
          </div>
        </div>
      </section>

      <section class="panel">
        <div class="results-header">
          <h2>Module requirements</h2>
        </div>
        <div class="notes">
          <div>
            <h3>Inputs</h3>
            <p>
              Cluster/namespace details, OIDC provider info, service image tag, and S3
              settings (<code>S3_BUCKET</code>, <code>S3_PREFIX</code>, <code>AWS_REGION</code>).
            </p>
          </div>
          <div>
            <h3>IRSA</h3>
            <p>
              Create a policy for <code>s3:PutObject</code>, <code>s3:GetObject</code>,
              <code>s3:ListBucket</code>, then bind it to <code>files-service-sa</code>.
            </p>
          </div>
          <div>
            <h3>Outputs</h3>
            <p>
              Export the bucket name, service account name, and any service/ingress endpoints.
            </p>
          </div>
        </div>
      </section>

      <section class="panel">
        <div class="results-header">
          <h2>Implementation details (from dev team)</h2>
        </div>
        <div class="notes">
          <div>
            <h3>Service</h3>
            <p>
              Node/Express + AWS SDK + multer with routes under
              <code>/api/files/*</code>.
            </p>
          </div>
          <div>
            <h3>Images</h3>
            <p>
              <code>prashantdey/merndemoapp:fileservice1.0</code> and
              <code>prashantdey/merndemoapp:clientv1.0</code>.
            </p>
          </div>
          <div>
            <h3>Kubernetes</h3>
            <p>
              Add <code>files-service-deployment.yml</code>,
              <code>files-service-cluster-ip-service.yml</code>, and
              <code>ingress-service.yml</code> (route <code>/api/files/*</code>).
            </p>
          </div>
        </div>
      </section>

      <section class="panel">
        <div class="results-header">
          <h2>Apply order + checks</h2>
        </div>
        <div class="notes">
          <div>
            <h3>DB init/migration</h3>
            <p>
              Ensure <code>postgres-init-config.yml</code> and
              <code>postgres-migrate-job.yml</code> are applied for the moods table.
            </p>
          </div>
          <div>
            <h3>Infra rollout</h3>
            <p>
              Apply S3 + IAM + IRSA, then deploy files-service and the ingress route.
            </p>
          </div>
          <div>
            <h3>Success criteria</h3>
            <p>Upload a file, list objects, and download it from the UI.</p>
          </div>
        </div>
      </section>

      <section class="panel">
        <div class="results-header">
          <h2>Teams</h2>
        </div>
        {% if teams %}
        <div class="notes">
          {% for team in teams %}
          <div>
            <h3>{{ team.name }}</h3>
            <p>{{ team.members }}</p>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <p>No teams configured yet.</p>
        {% endif %}
      </section>
    </main>
  </body>
</html>
